<div class="projections-container">
  <header class="page-header">
    <h1>Projections</h1>
  </header>

  <!-- Step 1: Inputs & Scenarios -->
  <section class="inputs-section">
    <div class="app-card">
      <div class="section-header">
        <h2>Scenarios & Inputs</h2>
      </div>
      
      <div class="input-grid">
        <div class="input-item">
          <label class="input-label">Projection Timeframe</label>
          <mat-button-toggle-group
            [value]="timeRangeMonths()"
            (change)="onTimeRangeChange($event.value)"
            class="segmented-control">
            <mat-button-toggle [value]="3">3M</mat-button-toggle>
            <mat-button-toggle [value]="6">6M</mat-button-toggle>
            <mat-button-toggle [value]="12">1Y</mat-button-toggle>
            <mat-button-toggle [value]="24">2Y</mat-button-toggle>
            <mat-button-toggle [value]="60">5Y</mat-button-toggle>
          </mat-button-toggle-group>
        </div>

        <div class="input-item">
          <label class="input-label">Chart Granularity</label>
          <mat-button-toggle-group
            [value]="granularity()"
            (change)="setGranularity($event.value)"
            class="segmented-control">
            <mat-button-toggle value="Daily">Daily</mat-button-toggle>
            <mat-button-toggle value="Weekly">Weekly</mat-button-toggle>
            <mat-button-toggle value="Monthly">Monthly</mat-button-toggle>
          </mat-button-toggle-group>
        </div>

        @if (debtChartData()) {
          <div class="input-item extra-payment">
            <div class="label-row">
              <label class="input-label">Extra Monthly Debt Payment</label>
              <span class="value">{{ formatCurrency(extraPayment()) }}</span>
            </div>
            <mat-slider min="0" max="1000" step="50" discrete showTickMarks>
              <input matSliderThumb [(ngModel)]="extraPayment" (ngModelChange)="onExtraPaymentChange()">
            </mat-slider>
          </div>
        }

        @if (investmentChartData()) {
          <div class="input-item">
            <label class="input-label">Investment Projections</label>
            <mat-slide-toggle
              [checked]="includeContributions()"
              (change)="toggleContributions($event.checked)">
              Include recurring contributions
            </mat-slide-toggle>
          </div>
        }
      </div>
    </div>
  </section>

  <!-- Step 2: Key Insights Grid -->
  <section class="insights-section">
    <div class="insights-grid">
      <!-- Debt Free Milestone -->
      @if (debtProjection()) {
        <div class="app-card insight-card accent">
          <span class="label">Projected Debt Free</span>
          <h3 class="value">{{ formatDate(debtProjection()!.debtFreeDate) }}</h3>
          @if (debtComparison(); as comp) {
            <span class="subtext positive">{{ comp.monthsSaved }} months saved with extra payment</span>
          }
        </div>
      }

      <!-- Crossover Milestone -->
      @if (crossoverDate()) {
        <div class="app-card insight-card crossover">
          <span class="label">Crossover Date ðŸŽ¯</span>
          <h3 class="value">{{ formatDate(crossoverDate()!) }}</h3>
          <span class="subtext">Returns will exceed interest costs</span>
        </div>
      }

      <!-- Net Worth Insight -->
      @if (netWorthChartData()) {
        <div class="app-card insight-card">
          <span class="label">Projected Net Worth</span>
          <h3 class="value">{{ formatCurrency(netWorthChartData()!.netWorth[netWorthChartData()!.netWorth.length - 1]) }}</h3>
          <span class="subtext">In {{ timeRangeMonths() }} months</span>
        </div>
      }

      <!-- Scheduled Contributions Insight -->
      @if (contributionCount() > 0) {
        <div class="app-card insight-card">
          <span class="label">Scheduled Contributions</span>
          <h3 class="value">{{ contributionCount() }} contributions</h3>
          <span class="subtext">{{ formatCurrency(totalScheduledContributions()) }} over projection period</span>
        </div>
      }

      <!-- Interest Insight -->
      @if (debtProjection()) {
        <div class="app-card insight-card">
          <span class="label">Total Interest Cost</span>
          <h3 class="value">{{ formatCurrency(debtProjection()!.totalInterestPaid) }}</h3>
          @if (debtComparison(); as comp) {
            <span class="subtext positive">Saving {{ formatCurrency(comp.interestSaved) }}</span>
          }
        </div>
      }
    </div>
  </section>

  <!-- Step 3: Detailed Charts -->
  <section class="charts-section">
    @if (loading()) {
      <div class="skeleton-charts">
        <div class="skeleton-chart-card"></div>
        <div class="skeleton-chart-card"></div>
      </div>
    } @else {
      <!-- Net Worth Chart (Top priority visualization) -->
      @if (netWorthChartData()) {
        <div class="app-card chart-card">
          <div class="section-header">
            <h2>Net Worth Trajectory</h2>
          </div>
          <app-net-worth-chart
            [data]="netWorthChartData()"
            [height]="'400px'"
            [compact]="false">
          </app-net-worth-chart>
        </div>
      }

      <!-- Debt Chart -->
      @if (debtChartData()) {
        <div class="app-card chart-card">
          <div class="section-header">
            <h2>Debt Payoff Curve</h2>
          </div>
          <app-debt-projection-chart
            [data]="debtChartData()"
            [height]="'400px'"
            [compact]="false"
            [granularity]="granularity()">
          </app-debt-projection-chart>
        </div>
      }

      <!-- Investment Chart -->
      @if (investmentChartData()) {
        <div class="app-card chart-card">
          <div class="section-header">
            <h2>Investment Growth</h2>
          </div>
          <app-investment-projection-chart
            [data]="investmentChartData()"
            [height]="'400px'"
            [compact]="false">
          </app-investment-projection-chart>
        </div>
      }
    }
  </section>
</div>