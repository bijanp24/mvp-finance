<div class="dashboard-container">
  @if (loading()) {
    <div class="loading-state">
      <p>Loading dashboard...</p>
    </div>
  } @else {
    <!-- Section 1: Hero Card - Safe to Spend -->
    <mat-card class="hero-card" appearance="outlined">
      <mat-card-header>
        <mat-card-title>Safe to Spend</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        @if (spendableResult()) {
          <div class="amount">{{ formatCurrency(spendableResult()!.spendableNow) }}</div>
        } @else {
          <div class="amount">{{ formatCurrency(totalCash()) }}</div>
        }
      </mat-card-content>
      <mat-card-footer>
        @if (spendableResult()) {
          <p class="subtext">Until next paycheck ({{ spendableResult()!.breakdown.daysUntilNextPaycheck }} days)</p>
        } @else if (accounts().length === 0) {
          <p class="subtext">Add accounts and transactions to get started</p>
        } @else {
          <p class="subtext">Total available cash</p>
        }
      </mat-card-footer>
    </mat-card>

    <!-- Section 2: Pace Tiles -->
    <div class="pace-tiles">
      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Total Cash</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="tile-amount positive">{{ formatCurrency(totalCash()) }}</div>
          <div class="tile-label">Available</div>
        </mat-card-content>
      </mat-card>

      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Total Debt</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="tile-amount negative">{{ formatCurrency(totalDebt()) }}</div>
          <div class="tile-label">Outstanding</div>
        </mat-card-content>
      </mat-card>

      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Investments</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="tile-amount accent">{{ formatCurrency(totalInvestments()) }}</div>
          <div class="tile-label">Growing</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Section 3: Recent Activity -->
    <mat-card class="recent-activity" appearance="outlined">
      <mat-card-header>
        <mat-card-title>Recent Transactions</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        @if (recentEvents().length === 0) {
          <div class="empty-state">
            <mat-icon>receipt_long</mat-icon>
            <p>No transactions yet</p>
            <a mat-raised-button color="primary" routerLink="/transactions">Add Transaction</a>
          </div>
        } @else {
          <mat-list>
            @for (event of recentEvents(); track event.id) {
              <mat-list-item>
                <mat-icon matListItemIcon>{{ getEventIcon(event.type) }}</mat-icon>
                <div matListItemTitle>{{ event.description || event.type }}</div>
                <div matListItemLine>
                  {{ getAccountName(event.accountId) }}
                  <span class="date-badge">{{ formatDisplayDate(event.date) }}</span>
                </div>
                <span class="amount" [class.income]="isIncome(event.type)" [class.expense]="isExpense(event.type)">
                  {{ isIncome(event.type) ? '+' : '-' }}{{ formatCurrency(event.amount) }}
                </span>
              </mat-list-item>
            }
          </mat-list>
        }
      </mat-card-content>
      <mat-card-actions>
        <a mat-button color="primary" routerLink="/transactions">View All</a>
      </mat-card-actions>
    </mat-card>
  }
</div>
