<div class="dashboard-container">
  @if (loading()) {
    <div class="skeleton-container" aria-busy="true">
      <!-- Hero Card Skeleton -->
      <div class="skeleton-hero-card" aria-hidden="true">
        <div class="skeleton-line skeleton-title"></div>
        <div class="skeleton-line skeleton-hero-amount"></div>
        <div class="skeleton-line skeleton-subtext"></div>
      </div>

      <!-- Pace Tiles Skeleton -->
      <div class="skeleton-pace-tiles" aria-hidden="true">
        <div class="skeleton-pace-card">
          <div class="skeleton-line skeleton-tile-title"></div>
          <div class="skeleton-line skeleton-tile-amount"></div>
          <div class="skeleton-line skeleton-tile-label"></div>
        </div>
        <div class="skeleton-pace-card">
          <div class="skeleton-line skeleton-tile-title"></div>
          <div class="skeleton-line skeleton-tile-amount"></div>
          <div class="skeleton-line skeleton-tile-label"></div>
        </div>
        <div class="skeleton-pace-card">
          <div class="skeleton-line skeleton-tile-title"></div>
          <div class="skeleton-line skeleton-tile-amount"></div>
          <div class="skeleton-line skeleton-tile-label"></div>
        </div>
      </div>

      <!-- Projection Charts Skeleton -->
      <div class="skeleton-projections" aria-hidden="true">
        <div class="skeleton-projection-card">
          <div class="skeleton-line skeleton-chart-title"></div>
          <div class="skeleton-chart-area"></div>
        </div>
        <div class="skeleton-projection-card">
          <div class="skeleton-line skeleton-chart-title"></div>
          <div class="skeleton-chart-area"></div>
        </div>
      </div>

      <!-- Recent Activity Skeleton -->
      <div class="skeleton-recent-activity" aria-hidden="true">
        <div class="skeleton-line skeleton-section-title"></div>
        <div class="skeleton-list-item"></div>
        <div class="skeleton-list-item"></div>
        <div class="skeleton-list-item"></div>
      </div>
    </div>
  } @else {
    <!-- Section 1: Hero Card - Safe to Spend -->
    <mat-card class="hero-card" appearance="outlined">
      <mat-card-header>
        <mat-card-title>Safe to Spend</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        @if (spendableResult()) {
          <div class="amount">{{ formatCurrency(spendableResult()!.spendableNow) }}</div>
        } @else {
          <div class="amount">{{ formatCurrency(totalCash()) }}</div>
        }
      </mat-card-content>
      <mat-card-footer>
        @if (spendableResult()) {
          <p class="subtext">Until next paycheck ({{ spendableResult()!.breakdown.daysUntilNextPaycheck }} days)</p>
        } @else if (accounts().length === 0) {
          <p class="subtext">Add accounts and transactions to get started</p>
        } @else {
          <p class="subtext">Total available cash</p>
        }
      </mat-card-footer>
    </mat-card>

    <!-- Section 2: Pace Tiles -->
    <div class="pace-tiles">
      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Total Cash</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="tile-amount positive">{{ formatCurrency(totalCash()) }}</div>
          <div class="tile-label">Available</div>
        </mat-card-content>
      </mat-card>

      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Total Debt</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="tile-amount negative">{{ formatCurrency(totalDebt()) }}</div>
          <div class="tile-label">Outstanding</div>
        </mat-card-content>
      </mat-card>

      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Investments</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="tile-amount accent">{{ formatCurrency(totalInvestments()) }}</div>
          <div class="tile-label">Growing</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Section 3: Projection Charts -->
    <div class="projections-section">
      <div class="projection-cards">
        <!-- Debt Projection -->
        <mat-card appearance="outlined">
          <mat-card-header>
            <mat-card-title>Debt Projection</mat-card-title>
            <a mat-button routerLink="/projections" class="view-details">
              View Details
              <mat-icon>arrow_forward</mat-icon>
            </a>
          </mat-card-header>
          <mat-card-content>
            @if (projectionsLoading()) {
              <div class="projection-skeleton" aria-busy="true">
                <div class="skeleton-line projection-skeleton-title" aria-hidden="true"></div>
                <div class="projection-skeleton-chart" aria-hidden="true"></div>
              </div>
            } @else if (debtChartData()) {
              <app-debt-projection-chart
                [data]="debtChartData()"
                [height]="'200px'"
                [compact]="true">
              </app-debt-projection-chart>
            } @else {
              <div class="empty-state">No debt accounts to project</div>
            }
          </mat-card-content>
        </mat-card>

        <!-- Investment Projection -->
        <mat-card appearance="outlined">
          <mat-card-header>
            <mat-card-title>Investment Growth</mat-card-title>
            <a mat-button routerLink="/projections" class="view-details">
              View Details
              <mat-icon>arrow_forward</mat-icon>
            </a>
          </mat-card-header>
          <mat-card-content>
            @if (projectionsLoading()) {
              <div class="projection-skeleton" aria-busy="true">
                <div class="skeleton-line projection-skeleton-title" aria-hidden="true"></div>
                <div class="projection-skeleton-chart" aria-hidden="true"></div>
              </div>
            } @else if (investmentChartData()) {
              <app-investment-projection-chart
                [data]="investmentChartData()"
                [height]="'200px'"
                [compact]="true">
              </app-investment-projection-chart>
            } @else {
              <div class="empty-state">No investment accounts to project</div>
            }
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Section 4: Recent Activity -->
    <mat-card class="recent-activity" appearance="outlined">
      <mat-card-header>
        <mat-card-title>Recent Transactions</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        @if (recentEvents().length === 0) {
          <div class="empty-state">
            <mat-icon>receipt_long</mat-icon>
            <p>No transactions yet</p>
            <a mat-raised-button color="primary" routerLink="/transactions">Add Transaction</a>
          </div>
        } @else {
          <mat-list>
            @for (event of recentEvents(); track event.id) {
              <mat-list-item>
                <mat-icon matListItemIcon>{{ getEventIcon(event.type) }}</mat-icon>
                <div matListItemTitle>{{ event.description || event.type }}</div>
                <div matListItemLine>
                  {{ getAccountName(event.accountId) }}
                  <span class="date-badge">{{ formatDisplayDate(event.date) }}</span>
                </div>
                <span class="amount" [class.income]="isIncome(event.type)" [class.expense]="isExpense(event.type)">
                  {{ isIncome(event.type) ? '+' : '-' }}{{ formatCurrency(event.amount) }}
                </span>
              </mat-list-item>
            }
          </mat-list>
        }
      </mat-card-content>
      <mat-card-actions>
        <a mat-button color="primary" routerLink="/transactions">View All</a>
      </mat-card-actions>
    </mat-card>

    <!-- Section 5: Calendar -->
    <app-calendar></app-calendar>
  }
</div>
