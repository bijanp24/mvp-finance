<div class="dashboard-container">
  @if (loading()) {
    <div class="skeleton-container" aria-busy="true">
      <div class="skeleton-hero-band"></div>
      <div class="skeleton-grid">
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
      </div>
      <div class="skeleton-list-card"></div>
    </div>
  } @else {
    <header class="page-header">
      <h1>Overview</h1>
    </header>

    <!-- Hero Band -->
    <section class="hero-band app-card">
      <div class="hero-content">
        <div class="hero-main">
          <span class="label">Safe to Spend Now</span>
          @if (spendableResult()) {
            <h2 class="amount">{{ formatCurrency(spendableResult()!.spendableNow) }}</h2>
            <p class="context">Until your next paycheck in {{ spendableResult()!.breakdown.daysUntilNextPaycheck }} days</p>
          } @else {
            <h2 class="amount">{{ formatCurrency(totalCash()) }}</h2>
            <p class="context">Add accounts and settings to calculate safe-to-spend</p>
          }
        </div>
        
        <div class="hero-stats">
          <div class="stat-item">
            <span class="stat-label">Next Paycheck</span>
            <span class="stat-value">{{ settings()?.nextPaycheckDate ? (settings()!.nextPaycheckDate | date:'MMM d') : 'Not set' }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Safety Buffer</span>
            <span class="stat-value">{{ formatCurrency(settings()?.safetyBuffer || 0) }}</span>
          </div>
        </div>

        <div class="hero-actions">
          <a mat-flat-button color="primary" routerLink="/transactions">
            <mat-icon>add</mat-icon>
            Add Transaction
          </a>
        </div>
      </div>
    </section>

    <!-- Metrics Grid -->
    <div class="metrics-grid">
      <div class="app-card metric-card">
        <span class="metric-label">Total Cash</span>
        <h3 class="metric-value">{{ formatCurrency(totalCash()) }}</h3>
        <span class="metric-trend positive">Available</span>
      </div>

      <div class="app-card metric-card">
        <span class="metric-label">Total Debt</span>
        <h3 class="metric-value">{{ formatCurrency(totalDebt()) }}</h3>
        <span class="metric-trend negative">Outstanding</span>
      </div>

      <div class="app-card metric-card">
        <span class="metric-label">Investments</span>
        <h3 class="metric-value">{{ formatCurrency(totalInvestments()) }}</h3>
        <span class="metric-trend accent">Growing</span>
      </div>

      <div class="app-card metric-card">
        <span class="metric-label">Net Worth</span>
        <h3 class="metric-value">{{ formatCurrency(netWorth()) }}</h3>
        <span class="metric-trend" [class.positive]="netWorth() >= 0" [class.negative]="netWorth() < 0">
          {{ netWorth() >= 0 ? 'Positive' : 'Negative' }}
        </span>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="dashboard-content">
      <!-- Recent Activity -->
      <section class="app-card recent-activity">
        <div class="section-header">
          <h2>Recent Transactions</h2>
          <a mat-button color="primary" routerLink="/transactions">View All</a>
        </div>

        @if (recentEvents().length === 0) {
          <div class="empty-state">
            <mat-icon>receipt_long</mat-icon>
            <p>No transactions yet</p>
          </div>
        } @else {
          <div class="transaction-list">
            @for (event of recentEvents(); track event.id) {
              <div class="transaction-row">
                <div class="transaction-icon">
                  <mat-icon>{{ getEventIcon(event.type) }}</mat-icon>
                </div>
                <div class="transaction-info">
                  <span class="description">{{ event.description || event.type }}</span>
                  <span class="account">{{ getAccountName(event.accountId) }}</span>
                </div>
                <div class="transaction-meta">
                  <span class="date">{{ formatDisplayDate(event.date) }}</span>
                  <span class="status-badge" [class]="event.status.toLowerCase()">{{ event.status }}</span>
                </div>
                <div class="transaction-amount" [class.income]="isIncome(event.type)" [class.expense]="isExpense(event.type)">
                  {{ isIncome(event.type) ? '+' : '-' }}{{ formatCurrency(event.amount) }}
                </div>
              </div>
            }
          </div>
        }
      </section>

      <!-- Quick Calendar -->
      <app-calendar></app-calendar>
    </div>

    <!-- Projections Preview -->
    <section class="projections-preview">
      <div class="section-header">
        <h2>Projections</h2>
        <a mat-button color="primary" routerLink="/projections">Deep Dive</a>
      </div>
      
      <div class="preview-grid">
        <div class="app-card chart-card">
          <h3>Debt Payoff</h3>
          @if (projectionsLoading()) {
            <div class="chart-placeholder"></div>
          } @else if (debtChartData()) {
            <app-debt-projection-chart
              [data]="debtChartData()"
              [height]="'240px'"
              [compact]="true">
            </app-debt-projection-chart>
          }
        </div>

        <div class="app-card chart-card">
          <h3>Wealth Growth</h3>
          @if (projectionsLoading()) {
            <div class="chart-placeholder"></div>
          } @else if (investmentChartData()) {
            <app-investment-projection-chart
              [data]="investmentChartData()"
              [height]="'240px'"
              [compact]="true">
            </app-investment-projection-chart>
          }
        </div>
      </div>
    </section>
  }
</div>